(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var c in s)e.o(s,c)&&!e.o(t,c)&&Object.defineProperty(t,c,{enumerable:!0,get:s[c]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{FIRST_WP_VERSION_WITH_THUNK_SUPPORT:()=>w,INITIAL_STATE:()=>d,STORE_NAME:()=>i,WP_VERSION:()=>v,actions:()=>c,applyThunkMiddleware:()=>O,clearFeedCache:()=>T,fetchRestApiAccounts:()=>m,fetchRestApiFeeds:()=>F,fetchRestApiSettings:()=>k,fetchRestApiUserProfile:()=>A,isVersionLessThan:()=>N,reducer:()=>s,resolvers:()=>o,selectors:()=>n,storeConfig:()=>J,useAccountsEntities:()=>b,useFeedsEntities:()=>R,useSettingsEntities:()=>E});var s={};e.r(s),e.d(s,{accounts:()=>u,default:()=>p,feeds:()=>l,settings:()=>h});var c={};e.r(c),e.d(c,{createAccount:()=>C,createFeed:()=>U,deleteAccount:()=>D,deleteFeed:()=>q,editFeed:()=>M,saveSettings:()=>L,setAccounts:()=>P,setFeeds:()=>I,setSettings:()=>j});var n={};e.r(n),e.d(n,{getAccounts:()=>V,getFeeds:()=>W,getSettings:()=>G});var o={};e.r(o),e.d(o,{getAccounts:()=>H,getFeeds:()=>$,getSettings:()=>x});const a=window.wp.i18n,r=window.wp.data,i="quadlayers/tiktok",d={accounts:[],feeds:[],settings:{flush:!1,spinner_id:0}};function u(e=d.accounts,t){return"SET_ACCOUNTS"===t.type?t.payload:e}function l(e=d.feeds,t){return"SET_FEEDS"===t.type?t.payload:e}function h(e=d.settings,t){return"SET_SETTINGS"===t.type?t.payload:e}const p=(0,r.combineReducers)({accounts:u,feeds:l,settings:h}),g=(window.lodash,window.wp.notices),S=window.wp.apiFetch;var f=e.n(S);async function y(e){return await f()(e).then((e=>{if(e.code)throw new Error(`${e.code}: ${e?.message||"Unknown"}`);return e})).catch((e=>{throw new Error(JSON.stringify(e))}))}const _=qlttf_store_routes,{WP_VERSION:v}=qlttf_store,w="6.0",F=({method:e,data:t}={})=>y({path:_.feeds,method:e,data:t});function R(){const{createFeed:e,editFeed:t,deleteFeed:s}=(0,r.useDispatch)(i),{feeds:c,isResolvingFeeds:n,hasResolvedFeeds:o}=(0,r.useSelect)((e=>{const{isResolving:t,hasFinishedResolution:s,getFeeds:c}=e(i);return{feeds:c(),isResolvingFeeds:t("getFeeds"),hasResolvedFeeds:s("getFeeds")}}),[]);return{feeds:c,isResolvingFeeds:n,hasResolvedFeeds:o,hasFeeds:!(!o||!Object.keys(c)?.length),createFeed:e,editFeed:t,deleteFeed:s}}function T({method:e,data:t}){return y({path:_.cache,method:e,data:t})}const m=({method:e,data:t}={})=>y({path:_.accounts,method:e,data:t}),A=({method:e,data:t})=>y({path:`${_.profile.account}`,method:e,data:t});function b(){const{createAccount:e,deleteAccount:t}=(0,r.useDispatch)(i),{accounts:s,isResolvingAccounts:c,hasResolvedAccounts:n}=(0,r.useSelect)((e=>{const{isResolving:t,hasFinishedResolution:s,getAccounts:c}=e(i);return{accounts:c(),isResolvingAccounts:t("getAccounts"),hasResolvedAccounts:s("getAccounts")}}),[]);return{accounts:s,isResolvingAccounts:c,hasResolvedAccounts:n,hasAccounts:!(!n||!Object.keys(s)?.length),createAccount:e,deleteAccount:t}}const k=({method:e,data:t}={})=>y({path:_.settings,method:e,data:t});function E(){const{saveSettings:e}=(0,r.useDispatch)(i),{settings:t,isResolvingSettings:s,hasResolvedSettings:c}=(0,r.useSelect)((e=>{const{isResolving:t,hasFinishedResolution:s,getSettings:c}=e(i);return{settings:c(),isResolvingSettings:t("getSettings"),hasResolvedSettings:s("getSettings")}}),[]);return{settings:t,isResolvingSettings:s,hasResolvedSettings:c,hasSettings:!(!c||!Object.keys(t)?.length),saveSettings:e}}const N=(e,t)=>{const s=e.split(".").map(Number),c=t.split(".").map(Number);for(let e=0;e<c.length;e++){if(s[e]<c[e])return!0;if(s[e]>c[e])return!1}return!1},O=e=>{const t=e.instantiate;return e.instantiate=e=>{const s=t(e);if(!s.store||!s.store.dispatch)throw new Error(__("The created instance does not contain a valid store.","insta-gallery"));const c=s.store.dispatch,n=((e,t)=>({registry:t,get dispatch(){return Object.assign((t=>e.store.dispatch(t)),e.getActions())},get select(){return Object.assign((t=>t(e.store.__unstableOriginalGetState())),e.getSelectors())},get resolveSelect(){return e.getResolveSelectors()}}))(s,e);return s.store.dispatch=((e,t)=>s=>"function"==typeof s?s(e):t(s))(n,c),s},e},P=async e=>({type:"SET_ACCOUNTS",payload:await Promise.all(e?.map((async e=>{try{const t=await A({method:"POST",data:{feedSettings:{open_id:e.open_id}}});return{...e,...t}}catch(t){return console.error(t),e}})))}),I=e=>({type:"SET_FEEDS",payload:e}),j=e=>({type:"SET_SETTINGS",payload:e}),C=e=>async({registry:t,dispatch:s,select:c,resolveSelect:n})=>{const o=c.getAccounts(),r=await m({method:"POST",data:e});return r?.code?(t.dispatch(g.store).createSuccessNotice(sprintf((0,a.__)("%s: %s"),r.code,r.message),{type:"snackbar"}),!1):(o.push(r),s.setAccounts([...o]),t.dispatch(g.store).createSuccessNotice((0,a.__)("The account has been created successfully.","wp-tiktok-feed"),{type:"snackbar"}),!0)},D=(e,t)=>async({registry:s,dispatch:c,select:n,resolveSelect:o})=>{const r=n.getAccounts(),i=await m({method:"DELETE",data:{open_id:e}});if(i?.code)return s.dispatch(g.store).createSuccessNotice(sprintf((0,a.__)("%s: %s"),i.code,i.message),{type:"snackbar"}),!1;const d=r.filter((t=>t.open_id!==e));return c.setAccounts([...d]),s.dispatch(g.store).createSuccessNotice(sprintf((0,a.__)("The account %s has been deleted.","wp-tiktok-feed"),t),{type:"snackbar"}),!0},U=e=>async({registry:t,dispatch:s,select:c,resolveSelect:n})=>{const o=c.getFeeds(),r=await F({method:"POST",data:{feed:e}});return r?.code?(t.dispatch(g.store).createSuccessNotice(sprintf((0,a.__)("%s: %s"),r.code,r.message),{type:"snackbar"}),!1):(o.push(r),s.setFeeds([...o]),t.dispatch(g.store).createSuccessNotice((0,a.__)("The feed has been created successfully.","wp-tiktok-feed"),{type:"snackbar"}),!0)},q=e=>async({registry:t,dispatch:s,select:c,resolveSelect:n})=>{const o=c.getFeeds(),r=await F({method:"DELETE",data:{feed_settings:e}});if(r?.code)return t.dispatch(g.store).createSuccessNotice(sprintf((0,a.__)("%s: %s"),r.code,r.message),{type:"snackbar"}),!1;const i=o.filter((t=>t.id!==e.id));return s.setFeeds([...i]),t.dispatch(g.store).createSuccessNotice(sprintf((0,a.__)("The feed %s has been deleted.","wp-tiktok-feed"),e.id),{type:"snackbar"}),!0},M=e=>async({registry:t,dispatch:s,select:c,resolveSelect:n})=>{const o=c.getFeeds(),r=await F({method:"PATCH",data:{feed:e}});return r?.code?(t.dispatch(g.store).createSuccessNotice(sprintf((0,a.__)("%s: %s"),r.code,r.message),{type:"snackbar"}),!1):(s.setFeeds([...o.map((t=>t.id==e.id?e:t))]),t.dispatch(g.store).createSuccessNotice((0,a.__)("The feed has been updated successfully.","wp-tiktok-feed"),{type:"snackbar"}),!0)},L=e=>async({registry:t,dispatch:s,select:c,resolveSelect:n})=>{const o=await k({method:"POST",data:e});return o?.code?(t.dispatch(g.store).createSuccessNotice(sprintf((0,a.__)("%s: %s"),o.code,o.message),{type:"snackbar"}),!1):(s.setSettings({...e}),t.dispatch(g.store).createSuccessNotice((0,a.__)("Settings saved.","wp-tiktok-feed"),{type:"snackbar"}),!0)},V=e=>e.accounts,W=e=>e.feeds,G=e=>e.settings,H=async()=>{try{const e=await m();return P(e)}catch(e){console.error(e)}},$=async()=>{try{const e=await F();return I(e)}catch(e){console.error(e)}},x=async()=>{try{const e=await k();return j(e)}catch(e){console.error(e)}},J={reducer:p,actions:c,selectors:n,resolvers:o},K=(0,r.createReduxStore)(i,J);(0,r.register)(N(v,w)?O(K):K),(window.qlttf=window.qlttf||{}).store=t})();